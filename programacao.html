<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Programa√ß√£o I ‚Äî Calculadora</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 720px; margin: 24px auto; padding: 0 16px; }
    a { color: inherit; }
    h1 { font-size: 20px; margin-bottom: 8px; }
    .box { border: 1px solid #ddd; border-radius: 12px; padding: 16px; }
    label { display: block; margin-top: 12px; font-weight: 600; }
    input, select { width: 100%; padding: 10px; margin-top: 6px; box-sizing: border-box; }
    .row { display: grid; grid-template-columns: 1fr; gap: 12px; margin-top: 12px; }
    @media (min-width: 640px){ .row { grid-template-columns: 1fr 1fr; } }
    .hint { font-size: 12px; color: #666; margin-top: 6px; }
    .warn { color: #b00020; font-size: 13px; margin-top: 10px; }
    .ok { color: #0a7a2f; font-size: 13px; margin-top: 10px; }
    .result { margin-top: 16px; padding: 14px; border-radius: 12px; background: #f5f5f5; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; }
    .topbar { display:flex; justify-content: space-between; align-items:center; gap: 12px; margin-bottom: 12px; }
    .back { font-size: 13px; color:#444; text-decoration:none; }
  </style>
</head>
<body>
  <div class="topbar">
    <h1>Programa√ß√£o I (INF15927) ‚Äî Calculadora</h1>
    <a class="back" href="index.html">‚Üê Voltar</a>
  </div>

  <div class="box">
    <div class="hint">
      MP = <span class="mono">0,3¬∑P1 + 0,3¬∑P2 + 0,3¬∑TP + 0,1¬∑LE</span><br>
      Se MP ‚â• 7 ‚Üí aprovado sem PF. Se MP &lt; 7 ‚Üí MF = (MP + PF)/2 e aprova se MF ‚â• 5.<br>
      Notas v√°lidas: 0 a 10
    </div>

    <div class="row">
      <div>
        <label for="p1">P1 (peso 0,3)</label>
        <input id="p1" type="number" inputmode="decimal" step="0.01" min="0" max="10" placeholder="0 a 10" />
        <div class="hint" id="hint-p1"></div>
      </div>
      <div>
        <label for="p2">P2 (peso 0,3)</label>
        <input id="p2" type="number" inputmode="decimal" step="0.01" min="0" max="10" placeholder="0 a 10" />
        <div class="hint" id="hint-p2"></div>
      </div>
    </div>

    <div class="row">
      <div>
        <label for="tp">TP (peso 0,3)</label>
        <input id="tp" type="number" inputmode="decimal" step="0.01" min="0" max="10" placeholder="0 a 10" />
        <div class="hint" id="hint-tp"></div>
      </div>
      <div>
        <label for="le">LE (peso 0,1)</label>
        <input id="le" type="number" inputmode="decimal" step="0.01" min="0" max="10" placeholder="0 a 10" />
        <div class="hint" id="hint-le"></div>
      </div>
    </div>

    <label for="pf">PF (Prova Final ‚Äî se necess√°rio)</label>
    <input id="pf" type="number" inputmode="decimal" step="0.01" min="0" max="10" placeholder="0 a 10 (pode deixar vazio)" />
    <div class="hint" id="hint-pf"></div>

    <div class="row">
      <div>
        <label for="alvo">Meta</label>
        <select id="alvo">
          <option value="7" selected>MP ‚â• 7 (passar sem PF)</option>
          <option value="5">MF ‚â• 5 (passar com PF)</option>
        </select>
        <div class="hint">Escolha o tipo de meta que voc√™ quer analisar.</div>
      </div>

      <div>
        <label for="faltando">Qual nota est√° faltando?</label>
        <select id="faltando">
          <option value="nenhuma">Nenhuma (todas preenchidas)</option>
          <option value="p1">P1</option>
          <option value="p2">P2</option>
          <option value="tp">TP</option>
          <option value="le">LE</option>
          <option value="pf">PF</option>
        </select>
        <div class="hint">Selecione aqui para ver ‚Äúquanto precisa‚Äù nessa nota.</div>
      </div>
    </div>

    <div class="result" id="saida">Preencha as notas (0 a 10). O c√°lculo atualiza sozinho.</div>
  </div>

  <script>
    const saida = document.getElementById("saida");
    const pesosMP = { p1: 0.3, p2: 0.3, tp: 0.3, le: 0.1 };
    const campos = ["p1","p2","tp","le","pf"];

    function parseNumero(valor) {
      if (typeof valor !== "string") return NaN;
      const v = valor.trim().replace(",", ".");
      if (v === "") return NaN;
      return Number(v);
    }

    function validarCampo(id) {
      const el = document.getElementById(id);
      const hint = document.getElementById("hint-" + id);
      const n = parseNumero(el.value);

      if (el.value.trim() === "") {
        hint.textContent = "";
        el.style.borderColor = "";
        return { ok: false, empty: true, value: NaN };
      }

      if (!Number.isFinite(n)) {
        hint.textContent = "‚ö†Ô∏è Digite um n√∫mero v√°lido.";
        el.style.borderColor = "#b00020";
        return { ok: false, empty: false, value: NaN };
      }

      if (n < 0 || n > 10) {
        hint.textContent = "‚ö†Ô∏è A nota precisa estar entre 0 e 10.";
        el.style.borderColor = "#b00020";
        return { ok: false, empty: false, value: n };
      }

      hint.textContent = "";
      el.style.borderColor = "";
      return { ok: true, empty: false, value: n };
    }

    function calcMP(n) {
      return (pesosMP.p1*n.p1 + pesosMP.p2*n.p2 + pesosMP.tp*n.tp + pesosMP.le*n.le);
    }

    function atualizar() {
      const st = {};
      let temErro = false;

      for (const c of campos) {
        st[c] = validarCampo(c);
        if (!st[c].empty && !st[c].ok) temErro = true;
      }

      if (temErro) {
        saida.innerHTML = "‚ö†Ô∏è Corrija as notas inv√°lidas (0 a 10) para calcular.";
        return;
      }

      const alvo = Number(document.getElementById("alvo").value);   // 7 (MP) ou 5 (MF)
      const faltando = document.getElementById("faltando").value;

      // helpers
      const temMPCompleta = ["p1","p2","tp","le"].every(k => !st[k].empty);
      const mpSePossivel = temMPCompleta ? Number(calcMP({
        p1: st.p1.value, p2: st.p2.value, tp: st.tp.value, le: st.le.value
      }).toFixed(2)) : NaN;

      // --- 1) Todas preenchidas ---
      if (faltando === "nenhuma") {
        // Se n√£o tem MP completa ainda
        if (!temMPCompleta) {
          saida.innerHTML = "Preencha P1, P2, TP e LE para calcular a MP.";
          return;
        }

        // Se MP >= 7: aprovado direto
        if (mpSePossivel >= 7.00) {
          saida.innerHTML =
            `‚úÖ MP: <b>${mpSePossivel.toFixed(2)}</b><br>` +
            `<span class="ok">APROVADO sem PF (MP ‚â• 7)</span>`;
          return;
        }

        // MP < 7 ‚Üí depende de PF
        if (st.pf.empty) {
          const pfNec = Number((10 - mpSePossivel).toFixed(2)); // MF>=5 => PF>=10-MP
          if (pfNec > 10) {
            saida.innerHTML =
              `üìå MP: <b>${mpSePossivel.toFixed(2)}</b><br>` +
              `<span class="warn">Mesmo com PF=10, n√£o alcan√ßa MF ‚â• 5 (precisaria de ${pfNec.toFixed(2)}).</span>`;
          } else {
            saida.innerHTML =
              `üìå MP: <b>${mpSePossivel.toFixed(2)}</b><br>` +
              `<span class="warn">Precisa fazer PF.</span><br>` +
              `Para passar (MF ‚â• 5), precisa de pelo menos <b>${Math.max(0,pfNec).toFixed(2)}</b> na <b>PF</b>.`;
          }
          return;
        }

        // Com PF preenchida: calcula MF
        const PF = Number(st.pf.value.toFixed(2));
        const MF = Number(((mpSePossivel + PF) / 2).toFixed(2));

        if (MF >= 5.00) {
          saida.innerHTML =
            `üìå MP: <b>${mpSePossivel.toFixed(2)}</b> | PF: <b>${PF.toFixed(2)}</b><br>` +
            `‚úÖ MF: <b>${MF.toFixed(2)}</b><br>` +
            `<span class="ok">APROVADO (MF ‚â• 5)</span>`;
        } else {
          const falta = Number((5.00 - MF).toFixed(2));
          saida.innerHTML =
            `üìå MP: <b>${mpSePossivel.toFixed(2)}</b> | PF: <b>${PF.toFixed(2)}</b><br>` +
            `‚ùå MF: <b>${MF.toFixed(2)}</b><br>` +
            `<span class="warn">REPROVADO ‚Äî faltam ${falta.toFixed(2)} pontos na MF para chegar em 5,00.</span>`;
        }
        return;
      }

      // --- 2) ‚ÄúQuanto preciso‚Äù em uma nota (igual Qu√≠mica) ---
      // A ideia: calcular o m√≠nimo necess√°rio no campo "faltando" para atingir a meta escolhida.
      // Regras:
      // - Se alvo=7: meta √© MP>=7 (n√£o envolve PF)
      // - Se alvo=5: meta √© MF>=5 (envolve PF se MP<7)
      //   e MF=(MP+PF)/2

      // Para cada caso, exigimos os outros campos necess√°rios preenchidos
      const outros = campos.filter(x => x !== faltando);

      // Verifica se os campos que precisamos (exceto o faltando) est√£o preenchidos
      // - Para MP: precisamos de P1,P2,TP,LE (exceto se um deles for o faltando)
      // - Para MF com PF: precisamos de MP + PF (exceto se PF for faltando)
      function vazio(id){ return st[id].empty; }

      // Caso meta MP>=7
      if (alvo === 7) {
        const needed = ["p1","p2","tp","le"].filter(x => x !== faltando);
        if (needed.some(vazio)) {
          saida.innerHTML = `Preencha as outras notas para eu calcular quanto voc√™ precisa em <b>${faltando.toUpperCase()}</b> para MP ‚â• 7.`;
          return;
        }
        if (faltando === "pf") {
          saida.innerHTML = `PF n√£o entra na MP. Para passar sem PF, a meta √© MP ‚â• 7 (usa P1, P2, TP, LE).`;
          return;
        }

        // MP = soma(peso*nota). Resolver x:
        // peso_f* x + soma_conhecida >= 7
        let soma = 0;
        for (const k of ["p1","p2","tp","le"]) {
          if (k === faltando) continue;
          soma += pesosMP[k] * st[k].value;
        }
        const w = pesosMP[faltando];
        const xNec = Number(((7 - soma) / w).toFixed(2));

        if (xNec <= 0) {
          saida.innerHTML = `‚úÖ Para MP ‚â• 7, voc√™ j√° est√° garantindo mesmo com <b>0.00</b> em <b>${faltando.toUpperCase()}</b>.`;
        } else if (xNec > 10) {
          saida.innerHTML = `‚ùå Para MP ‚â• 7, precisaria de <b>${xNec.toFixed(2)}</b> em <b>${faltando.toUpperCase()}</b> (acima de 10).`;
        } else {
          saida.innerHTML = `üìå Para MP ‚â• 7, precisa de pelo menos <b>${xNec.toFixed(2)}</b> em <b>${faltando.toUpperCase()}</b>.`;
        }
        return;
      }

      // Caso meta MF>=5
      // Se MP >=7, MF nem precisa: j√° aprovou, mas a regra do plano diz que com MP>=7 passa direto.
      // Se MP<7: precisa de PF e MF=(MP+PF)/2 >=5
      if (alvo === 5) {
        // Precisamos de P1,P2,TP,LE (exceto se um deles √© faltando) para calcular MP.
        const neededMP = ["p1","p2","tp","le"].filter(x => x !== faltando);
        if (neededMP.some(vazio)) {
          saida.innerHTML = `Preencha as outras notas para eu calcular quanto voc√™ precisa em <b>${faltando.toUpperCase()}</b> para MF ‚â• 5.`;
          return;
        }

        // Calcula MP em fun√ß√£o do faltando (se faltando for um de MP) ou fixa MP se faltando for PF
        let mpFixo = 0;
        for (const k of ["p1","p2","tp","le"]) {
          if (k === faltando) continue;
          mpFixo += pesosMP[k] * st[k].value;
        }

        if (faltando === "pf") {
          const MP = Number(mpFixo.toFixed(2));
          if (MP >= 7.00) {
            saida.innerHTML = `‚úÖ Sua MP j√° √© <b>${MP.toFixed(2)}</b> (‚â• 7). Voc√™ est√° aprovado sem precisar de PF.`;
            return;
          }
          const pfNec = Number((10 - MP).toFixed(2)); // MF>=5 => PF>=10-MP
          if (pfNec <= 0) {
            saida.innerHTML = `‚úÖ Para MF ‚â• 5, voc√™ precisaria de <b>0.00</b> na PF (j√° garantido).`;
          } else if (pfNec > 10) {
            saida.innerHTML = `‚ùå Para MF ‚â• 5, precisaria de <b>${pfNec.toFixed(2)}</b> na PF (acima de 10).`;
          } else {
            saida.innerHTML = `üìå Para MF ‚â• 5, precisa de pelo menos <b>${pfNec.toFixed(2)}</b> na <b>PF</b>.`;
          }
          return;
        }

        // faltando √© uma das notas da MP (p1,p2,tp,le)
        // MP = mpFixo + w*x
        // Se MP >= 7, j√° passa sem PF, mas a meta MF>=5 √© automaticamente satisfeita.
        // Por√©m, como MP depende de x, achamos:
        // 1) x para MP>=7 (passa direto)
        // 2) x para MP<7 mas ainda poder passar com PF=10: MF>=5 => PF>=10-MP, ent√£o com PF=10 sempre MF=(MP+10)/2 >=5 se MP>=0 (sempre)
        // Na pr√°tica: se MP<7, sempre √© poss√≠vel passar com PF dependendo da PF. Aqui vamos assumir PF = 10? N√£o.
        // Melhor: como a meta √© MF>=5, e PF √© vari√°vel, precisamos de um crit√©rio.
        // Vamos considerar PF ainda desconhecida -> mostramos duas coisas:
        // - valor m√≠nimo de x para j√° passar direto (MP>=7)
        // - se n√£o passar direto, voc√™ vai pra PF e a√≠ a nota m√≠nima na PF depende do MP.

        const w = pesosMP[faltando];
        const xParaMP7 = Number(((7 - mpFixo) / w).toFixed(2));

        // E tamb√©m mostramos a PF necess√°ria como fun√ß√£o do MP usando o MP m√≠nimo com x=0 ou x=10? melhor: usando x atual se digitado.
        const xDigitado = st[faltando].empty ? NaN : st[faltando].value;
        let extra = "";

        if (Number.isFinite(xDigitado)) {
          const MPcomX = Number((mpFixo + w*xDigitado).toFixed(2));
          if (MPcomX >= 7.00) {
            extra = `<br>Com <b>${xDigitado.toFixed(2)}</b> em ${faltando.toUpperCase()}, sua MP fica <b>${MPcomX.toFixed(2)}</b> ‚Üí aprovado sem PF.`;
          } else {
            const pfNec = Number((10 - MPcomX).toFixed(2));
            extra = `<br>Com <b>${xDigitado.toFixed(2)}</b> em ${faltando.toUpperCase()}, sua MP fica <b>${MPcomX.toFixed(2)}</b> e voc√™ precisaria de <b>${pfNec.toFixed(2)}</b> na PF para MF ‚â• 5.`;
          }
        }

        if (xParaMP7 <= 0) {
          saida.innerHTML = `‚úÖ Para j√° passar sem PF (MP ‚â• 7), voc√™ precisa de <b>0.00</b> ou mais em <b>${faltando.toUpperCase()}</b>.` + extra;
        } else if (xParaMP7 > 10) {
          saida.innerHTML = `üìå Para passar sem PF (MP ‚â• 7), precisaria de <b>${xParaMP7.toFixed(2)}</b> em <b>${faltando.toUpperCase()}</b> (acima de 10).<br>
          Ent√£o voc√™ vai depender da PF (MF ‚â• 5).` + extra;
        } else {
          saida.innerHTML = `üìå Para passar sem PF (MP ‚â• 7), precisa de pelo menos <b>${xParaMP7.toFixed(2)}</b> em <b>${faltando.toUpperCase()}</b>.` + extra;
        }
        return;
      }
    }

    campos.forEach(id => {
      document.getElementById(id).addEventListener("input", atualizar);
      document.getElementById(id).addEventListener("change", atualizar);
    });
    document.getElementById("alvo").addEventListener("change", atualizar);
    document.getElementById("faltando").addEventListener("change", atualizar);

    atualizar();
  </script>
</body>
</html>
